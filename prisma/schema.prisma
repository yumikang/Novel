// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model OriginalWork {
  id              String      @id @default(uuid())
  title           String
  mediaType       String
  source          String      @default("Custom") // 'Preset' | 'Custom'
  
  canonCharacters Character[] @relation("OriginalWorkCharacters")
  worldRules      WorldRule[]
  projects        Project[]

  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt
}

model Character {
  id              String   @id @default(uuid())
  name            String
  isCanon         Boolean  @default(true)
  description     String?
  
  personality     String[]
  appearance      String[]
  abilities       String[]
  speechPatterns  String[]
  relationships   Json?    // Relationship[]

  // Relations
  originalWorkId  String?
  originalWork    OriginalWork? @relation("OriginalWorkCharacters", fields: [originalWorkId], references: [id], onDelete: Cascade)

  projectId       String?
  project         Project?      @relation("ProjectCustomCharacters", fields: [projectId], references: [id], onDelete: Cascade)

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

model WorldRule {
  id              String       @id @default(uuid())
  title           String
  description     String
  
  originalWorkId  String
  originalWork    OriginalWork @relation(fields: [originalWorkId], references: [id], onDelete: Cascade)

  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt
}

model Project {
  id                 String       @id @default(uuid())
  title              String
  
  originalWorkId     String
  originalWork       OriginalWork @relation(fields: [originalWorkId], references: [id])

  timelineSetting    String
  auSettings         String[]
  activeCharacterIds String[]     // List of character IDs used in this project
  
  customCharacters   Character[]  @relation("ProjectCustomCharacters")
  foreshadows        Foreshadow[]
  
  tone               Json         // ToneProfile
  
  createdAt          DateTime     @default(now())
  updatedAt          DateTime     @updatedAt
}

model Foreshadow {
  id             String   @id @default(uuid())
  title          String
  description    String
  status         String   // 'Pending' | 'InProgress' | 'Resolved' | 'Dropped'
  plantedAt      String?
  expectedPayoff String?

  projectId      String
  project        Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)

  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
}
